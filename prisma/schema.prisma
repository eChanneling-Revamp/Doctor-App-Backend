generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Doctor {
  id           Int           @id @default(autoincrement())
  name         String
  email        String        @unique
  sessions     Session[]
  appointments Appointment[] @relation("DoctorAppointments") // ✅ opposite relation added
}

model Session {
  id              Int      @id @default(autoincrement())
  doctorId        Int
  hospitalName    String
  patientCapacity Int
  startTime       DateTime
  endTime         DateTime
  sessionType     String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  doctor       Doctor        @relation(fields: [doctorId], references: [id])
  appointments Appointment[] // ✅ opposite relation added
}

model Patient {
  id            Int            @id @default(autoincrement())
  name          String
  email         String?        @unique
  age           Int?
  patientId     String?        @unique
  ref           String?
  status        String         @default("Active")
  appointments  Appointment[]
  prescriptions Prescription[]
}

model Appointment {
  id        Int      @id @default(autoincrement())
  sessionId Int
  doctorId  Int
  patientId Int
  status    String   @default("Scheduled")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor  Doctor  @relation("DoctorAppointments", fields: [doctorId], references: [id])
  patient Patient @relation(fields: [patientId], references: [id])
  session Session @relation(fields: [sessionId], references: [id])
}

model Prescription {
  id        Int                      @id @default(autoincrement())
  patientId Int
  createdAt DateTime                 @default(now())
  medicines MedicineOnPrescription[]
  patient   Patient                  @relation(fields: [patientId], references: [id])
}

model Medicine {
  id            Int                      @id @default(autoincrement())
  name          String                   @unique
  dosage        String?
  frequency     String?
  instructions  String?
  favorites     Boolean                  @default(false)
  prescriptions MedicineOnPrescription[]
}

model MedicineOnPrescription {
  id             Int          @id @default(autoincrement())
  prescriptionId Int
  medicineId     Int
  dosage         String
  frequency      String
  period         String
  specialNote    String?
  medicine       Medicine     @relation(fields: [medicineId], references: [id])
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])
}
